(()=>{"use strict";var e={n:s=>{var t=s&&s.__esModule?()=>s.default:()=>s;return e.d(t,{a:t}),t},d:(s,t)=>{for(var r in t)e.o(t,r)&&!e.o(s,r)&&Object.defineProperty(s,r,{enumerable:!0,get:t[r]})},o:(e,s)=>Object.prototype.hasOwnProperty.call(e,s)};const s=require("express");var t=e.n(s);const r=require("cookie-parser");var o=e.n(r);const a=require("redis");var n=e.n(a);const i=require("uuid"),d=n().createClient(process.env.REDIS_URL),u=t()();u.set("views","./");const c=process.env.PORT||3e3;u.use(t().static(__dirname+"/public")),u.use(t().json()),u.use(o()()),u.use(((e,s,t)=>{e.userId=e.cookies.todoUserId,e.userId||(e.userId=(0,i.v4)(),s.cookie("todoUserId",e.userId)),t()})),u.get("/",((e,s)=>{s.render("index.ejs",{title:"Todo List"})})),u.get("/api/v1/tasks",(async(e,s)=>{const t=await((e,s)=>new Promise(((t,r)=>e.hgetall(s,((e,s)=>e?r(e):t(function(e){return Object.values(e).map((e=>JSON.parse(e)))}(s)))))))(d,e.userId);s.status(200).send(t)})),u.post("/api/v1/tasks",(async(e,s)=>{const t=await((e,s,t)=>(t.id=t.id||(0,i.v4)(),new Promise(((r,o)=>e.hset(s,t.id,JSON.stringify(t),((e,s)=>e?o(e):r(t)))))))(d,e.userId,e.body);s.status(200).send(t)})),u.delete("/api/v1/tasks/:taskId",(async(e,s)=>{await((e,s,t)=>new Promise(((r,o)=>e.hdel(s,t,((e,s)=>e?o(e):r())))))(d,e.userId,e.params.taskId),s.status(200).send()})),u.listen(c,(()=>console.log("listening on port "+c)))})();
//# sourceMappingURL=server.bundle.js.map