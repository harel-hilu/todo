(()=>{"use strict";var e={n:n=>{var t=n&&n.__esModule?()=>n.default:()=>n;return e.d(t,{a:t}),t},d:(n,t)=>{for(var o in t)e.o(t,o)&&!e.o(n,o)&&Object.defineProperty(n,o,{enumerable:!0,get:t[o]})},o:(e,n)=>Object.prototype.hasOwnProperty.call(e,n)};const n=require("express");var t=e.n(n);const o=require("cookie-parser");var i=e.n(o);const r=require("redis");var s=e.n(r);const d=require("uuid");var c=function(e,n,t,o){return new(t||(t=Promise))((function(i,r){function s(e){try{c(o.next(e))}catch(e){r(e)}}function d(e){try{c(o.throw(e))}catch(e){r(e)}}function c(e){var n;e.done?i(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(s,d)}c((o=o.apply(e,n||[])).next())}))};Function.prototype.promisify=function(e,...n){return new Promise(((t,o)=>{this.call(e,...n,((e,n)=>e?o(e):t(n)))}))};var u=function(e,n,t,o){return new(t||(t=Promise))((function(i,r){function s(e){try{c(o.next(e))}catch(e){r(e)}}function d(e){try{c(o.throw(e))}catch(e){r(e)}}function c(e){var n;e.done?i(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(s,d)}c((o=o.apply(e,n||[])).next())}))};const a=s().createClient(process.env.REDIS_URL),v=t()();v.set("views","./");const f=process.env.PORT||"3000";v.use(t().static(__dirname+"/public")),v.use(t().json()),v.use(i()()),v.use(((e,n,t)=>{e.userId=e.cookies.todoUserId,e.userId||(e.userId=(0,d.v4)(),n.cookie("todoUserId",e.userId)),t()})),v.get("/",((e,n)=>{n.render("index.ejs",{title:"Todo List"})})),v.get("/api/v1/tasks",((e,n)=>u(void 0,void 0,void 0,(function*(){const t=yield((e,n)=>c(void 0,void 0,void 0,(function*(){return function(e){const n={};for(const t in e)n[t]=JSON.parse(e[t]);return n}(yield e.hgetall.promisify(e,n))})))(a,e.userId);n.send(t)})))),v.post("/api/v1/tasks",((e,n)=>u(void 0,void 0,void 0,(function*(){const t=yield((e,n,t)=>c(void 0,void 0,void 0,(function*(){return t.id=t.id||(0,d.v4)(),yield e.hset.promisify(e,n,t.id,JSON.stringify(t)),t})))(a,e.userId,e.body);n.send(t)})))),v.delete("/api/v1/tasks/:taskId",((e,n)=>u(void 0,void 0,void 0,(function*(){yield((e,n,t)=>e.hdel.promisify(e,n,t))(a,e.userId,e.params.taskId),n.send()})))),v.listen(f,(()=>console.log(`listening on port ${f}`)))})();
//# sourceMappingURL=server.bundle.js.map