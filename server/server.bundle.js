(()=>{"use strict";var e={n:t=>{var s=t&&t.__esModule?()=>t.default:()=>t;return e.d(s,{a:s}),s},d:(t,s)=>{for(var n in s)e.o(s,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:s[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=require("express");var s=e.n(t);const n=require("cookie-parser");var o=e.n(n);const r=require("redis");var i=e.n(r);const d=require("uuid");var u=function(e,t,s,n){return new(s||(s=Promise))((function(o,r){function i(e){try{u(n.next(e))}catch(e){r(e)}}function d(e){try{u(n.throw(e))}catch(e){r(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(i,d)}u((n=n.apply(e,t||[])).next())}))};const a=i().createClient(process.env.REDIS_URL),c=s()();c.set("views","./");const v=process.env.PORT||"3000";c.use(s().static(__dirname+"/public")),c.use(s().json()),c.use(o()()),c.use(((e,t,s)=>{e.userId=e.cookies.todoUserId,e.userId||(e.userId=(0,d.v4)(),t.cookie("todoUserId",e.userId)),s()})),c.get("/",((e,t)=>{t.render("index.ejs",{title:"Todo List"})})),c.get("/api/v1/tasks",((e,t)=>u(void 0,void 0,void 0,(function*(){const s=yield((e,t)=>new Promise(((s,n)=>e.hgetall(t,((e,t)=>e?n(e):s(function(e){const t={};for(const s in e)t[s]=JSON.parse(e[s]);return t}(t)))))))(a,e.userId);t.status(200).send(s)})))),c.post("/api/v1/tasks",((e,t)=>u(void 0,void 0,void 0,(function*(){const s=yield((e,t,s)=>(s.id=s.id||(0,d.v4)(),new Promise(((n,o)=>e.hset(t,s.id,JSON.stringify(s),((e,t)=>e?o(e):n(s)))))))(a,e.userId,e.body);t.status(200).send(s)})))),c.delete("/api/v1/tasks/:taskId",((e,t)=>u(void 0,void 0,void 0,(function*(){yield((e,t,s)=>new Promise(((n,o)=>e.hdel(t,s,((e,t)=>e?o(e):n())))))(a,e.userId,e.params.taskId),t.status(200).send()})))),c.listen(v,(()=>console.log(`listening on port ${v}`)))})();
//# sourceMappingURL=server.bundle.js.map